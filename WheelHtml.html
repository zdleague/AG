<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Vertical Wheel from Google Sheets</title>
  <style>
    body {
      background-color: #000;
      color: #fff;
      margin: 0;
      overflow: hidden;
      font-family: Dead Kansas;
      display: flex; 
      justify-content: center;
      align-items: center;
      height: 100vh;
    } 
    #wheel-container {
      border: 4px solid white;
      width: 300px;
      height: 180px;
      overflow: hidden;
      position: relative;
      <div class="center-marker">‚ñ≤</div>
    }

  #wheel {
      position: absolute;
      width: 100%;
      transition: transform 4s cubic-bezier(0.2, 0.8, 0.2, 1);
    }
    .item {
      height: 60px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      border-bottom: 1px solid #444;
      background: #222
    }
    .indicator {
      position: absolute;
      top: 360px;
      left: 0px;
      width: 100%;
      text-align: center;
      font-size: 20px;
      color: red;
      pointer-events: none;
      z-index: 10;
    }

.indicator2 {
      position: absolute;
      top: 360px;
      left: 700px;
      width: 100%;
      text-align: center-right;
      font-size: 12px;
      color: red;
      pointer-events: none;
    }
.item::after {
  content: attr(data-index);
  position: absolute;
  right: 10px;
  color: yellow;
  font-size: 10px;
}
  </style>
</head>
<body>
  <div class="indicator"> ‚óÄ </div>
  <div class="indicator2"> ‚ñ∂ </div>
  <div id="wheel-container">
    <div id="wheel"></div>
  </div>

  <script> // Need the script to call the spreedsheet, but its calling an unexpected token on the ending /script bit 
    const wheel = document.getElementById('wheel');
    let options = [];

    const sheetURL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQs-Szpo_J6BXehkgdXROIt99TcipqnMHCizMdkpMJ2-Ag2mY_C_n1j2Ij-OekVbLTrmarwt4m6b-6p/pub?output=csv';

    async function loadOptionsFromSheet() {
      try {
        const res = await fetch(sheetURL);
        const text = await res.text();
        options = text
          .split('\n')
          .map(line => line.trim())
          .filter(line => line.length > 0);
        buildWheel();
      } catch (err) {
        console.error("Error loading Google Sheet:", err);
        options = ["Error loading sheet"];
        buildWheel();
      }
    }

   function buildWheel() {
  wheel.innerHTML = '';

  for (let i = 0; i < 7; i++) { // Repeat 6 times for smooth scrolling
    options.forEach((option, idx) => {
      const div = document.createElement('div');
      div.className = 'item';
      div.textContent = option;
      div.setAttribute('data-index', idx); // üëà this line
      wheel.appendChild(div);
    });
  }
}
//This is where Im having a problem and may need to replace with the OG code which is in backup
console.log("‚úÖ Overlay loaded and script is running!");

  function spinWheel() {
    if (options.length === 0) return;

    const itemHeight = 60;
    const repeats = 6;
    const visibleItems = 3;
    const randomIndex = Math.floor(Math.random() * options.length);
    const stopIndex = options.length * 3 + randomIndex - 0.85;
    const scrollDistance = stopIndex * itemHeight;

    // Clear previous highlights
    items.forEach(item => {
      item.style.backgroundColor = '#222';
      item.style.color = '#fff';
    });

    // Force reflow trick to ensure transition kicks in
    wheel.offsetHeight; // trigger reflow

    // Apply animation
    wheel.style.transition = "transform 7s cubic-bezier(0.25, 1, 0.5, 1)";
    wheel.style.transform = `translateY(-${scrollDistance}px)`;
    console.log("Spinning to:", -scrollDistance, "px (item:", randomIndex, ")");

    // After spin completes...
    setTimeout(() => {

      const items = document.querySelectorAll('.item');

      const winnerItem = items[stopIndex];
       if (!winnerItem) {
    console.error("‚ùå Couldn't find winner item at index", stopIndex);
    return;
  }

      // Highlight the winner
      winnerItem.style.backgroundColor = '#4CAF50';
      winnerItem.style.color = '#fff';

      // Show winner after highlight
      setTimeout(() => {
        console.log(`üéâ Winner: ${winnerItem.textContent.trim()} üéâ`);
        
        // Reset the wheel after showing the winner
        resetWheel();
      }, 5000); // Wait a bit before resetting the wheel
    }, 7200); // After spin completes
  }

  function resetWheel() {
    // Clear highlight and reset the position smoothly
    const items = document.querySelectorAll('.item');
    
    // Clear the highlight from the winner
    items.forEach(item => {
      item.style.backgroundColor = '#222';
      item.style.color = '#fff';
    });

    // Reset the wheel to the top position without a snap
    wheel.style.transition = "transform 5s ease-out"; // Smooth transition
    wheel.style.transform = "none"; // Reset position

    // Optional: Reset wheel position after a small delay (for smoothness)
    setTimeout(() => {
      console.log("Wheel reset!");
    }, 7200);
  }


    // Optional: click to test
    document.body.addEventListener("click", spinWheel);

    loadOptionsFromSheet();

    // This function will be called directly from Mix It Up via HTML Action
window.spinFromMixItUp = function () {
  console.log("üîÅ spinFromMixItUp() was called!");
  spinWheel();
};
     
    </script>
  </body>
</html>

